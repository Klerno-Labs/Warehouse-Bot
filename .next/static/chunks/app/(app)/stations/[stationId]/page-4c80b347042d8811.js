(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[544],{4689:function(e,t,n){Promise.resolve().then(n.bind(n,784))},784:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var r=n(7437),a=n(2265),s=n(16),i=n(4513),l=n(1304),o=n(1219),d=n(3579),c=n(6126),u=n(9459),f=n(3340),m=n(1119);let x={receiving:{label:"Receiving",actions:["RECEIVE","MOVE","HOLD"],workcellName:"Receiving Dock 1"},stockroom:{label:"Stockroom / Kitting",actions:["MOVE","ISSUE_TO_WORKCELL","RETURN"],workcellName:"Kitting Station A"},pleater1:{label:"Pleater 1",actions:["ISSUE_TO_WORKCELL","RETURN"],workcellName:"Pleater 1"},packing:{label:"Packing / Shipping",actions:["MOVE","RETURN"],workcellName:"Packing Station 1"}},p={RECEIVE:"Receive",MOVE:"Move",ISSUE_TO_WORKCELL:"Issue to Workcell",RETURN:"Return",SCRAP:"Scrap",HOLD:"Hold",RELEASE:"Release",COUNT:"Count",ADJUST:"Adjust"};function h(e){let{stationId:t}=e,n=x[t||""],{currentSite:h,user:v}=(0,f.a)(),{toast:y}=(0,u.pm)(),[g,j]=(0,a.useState)(""),[N,b]=(0,a.useState)(""),[w,S]=(0,a.useState)(""),[E,O]=(0,a.useState)(""),[R,T]=(0,a.useState)(""),[C,I]=(0,a.useState)(""),[k,_]=(0,a.useState)(""),[A,L]=(0,a.useState)(()=>(0,m.Sg)()),[D,U]=(0,a.useState)(!1),M=(0,a.useRef)(null),K=(0,a.useRef)(null),P=(0,a.useRef)(null),q=(0,a.useRef)(null),V=(null==h?void 0:h.id)||"",{data:z=[]}=(0,s.a)({queryKey:["/api/inventory/items"]}),{data:Z=[]}=(0,s.a)({queryKey:["/api/inventory/locations?siteId=".concat(V)],enabled:!!V}),{data:F=[]}=(0,s.a)({queryKey:["/api/inventory/reason-codes"]}),{data:W=[]}=(0,s.a)({queryKey:["/api/sites/".concat(V,"/workcells")],enabled:!!V}),Y=(0,a.useMemo)(()=>z.find(e=>e.sku.toLowerCase()===N.trim().toLowerCase()),[z,N]),Q=(0,a.useMemo)(()=>Z.find(e=>e.label.toLowerCase()===w.trim().toLowerCase()),[Z,w]),H=(0,a.useMemo)(()=>Z.find(e=>e.label.toLowerCase()===E.trim().toLowerCase()),[Z,E]),J=(null==Y?void 0:Y.allowedUoms.map(e=>e.uom))||[],B=(0,a.useMemo)(()=>{var e;return n&&(null===(e=W.find(e=>e.name===n.workcellName))||void 0===e?void 0:e.id)||null},[W,n]),G=A.filter(e=>"queued"===e.status).length,$=A.filter(e=>"needs-review"===e.status).length;if(!n)return(0,r.jsx)("div",{className:"flex h-full items-center justify-center p-6",children:(0,r.jsx)(l.Zb,{className:"max-w-md text-center",children:(0,r.jsxs)(l.aY,{className:"py-12",children:[(0,r.jsx)("h3",{className:"text-lg font-medium",children:"Station Not Found"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"The requested station does not exist."})]})})});if(v&&!["Operator","Inventory","Supervisor","Admin"].includes(v.role))return(0,r.jsx)("div",{className:"flex h-full items-center justify-center p-6",children:(0,r.jsx)(l.Zb,{className:"max-w-md text-center",children:(0,r.jsxs)(l.aY,{className:"py-12",children:[(0,r.jsx)("h3",{className:"text-lg font-medium",children:"Access Denied"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Your role does not have access to station mode."})]})})});let X="SCRAP"===g||"ADJUST"===g||"HOLD"===g;(0,a.useEffect)(()=>{Y?I(Y.baseUom):I("")},[Y]),(0,a.useEffect)(()=>{_("")},[g]);let ee=()=>{b(""),S(""),O(""),T(""),I(""),_(""),setTimeout(()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.focus()},0)},et=()=>{if(!V)return y({title:"No site selected",variant:"destructive"}),null;if(!g)return y({title:"Select an action",variant:"destructive"}),null;if(!Y)return y({title:"Item not found",description:"Scan a valid SKU",variant:"destructive"}),null;if(!C)return y({title:"Select a UoM",variant:"destructive"}),null;if(!R||Number.isNaN(Number(R)))return y({title:"Enter a valid quantity",variant:"destructive"}),null;if(!Q&&["MOVE","ISSUE_TO_WORKCELL","RETURN","SCRAP","HOLD","RELEASE"].includes(g))return y({title:"Scan from location",variant:"destructive"}),null;if(!H&&["RECEIVE","MOVE","ISSUE_TO_WORKCELL","RETURN","HOLD","RELEASE","COUNT"].includes(g))return y({title:"Scan to location",variant:"destructive"}),null;let e={siteId:V,eventType:g,itemId:Y.id,qtyEntered:Number(R),uomEntered:C,fromLocationId:null==Q?void 0:Q.id,toLocationId:null==H?void 0:H.id,workcellId:B,reasonCodeId:k||void 0};return X&&!k?(y({title:"Reason code required",variant:"destructive"}),null):e},en=async()=>{let e=et();if(e)try{let t=await fetch("/api/inventory/events",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok){let n=await t.text(),r={id:"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,9)),payload:e,status:"needs-review",error:n,createdAt:new Date().toISOString()},a=(0,m.K4)(r);L(a),y({title:"Needs review",description:"Server rejected the event. Saved for review.",variant:"destructive"});return}y({title:"Event recorded"}),ee()}catch(n){let t={id:"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,9)),payload:e,status:"queued",createdAt:new Date().toISOString()};L((0,m.K4)(t)),y({title:"Offline",description:"Event queued for sync."})}},er=async()=>{U(!0);let e=(0,m.Sg)();for(let t of e)if("queued"===t.status)try{let n=await fetch("/api/inventory/events",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t.payload)});if(!n.ok){let r=await n.text();e=(0,m.un)(t.id,{status:"needs-review",error:r});continue}e=(0,m.oo)(t.id)}catch(e){break}L(e),U(!1)};return(0,r.jsxs)("div",{className:"flex h-full flex-col gap-6 p-6",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-2xl font-semibold tracking-tight",children:[n.label," Station"]}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Scan and transact inventory with minimal taps."})]}),(0,r.jsxs)(l.Zb,{className:"w-full max-w-xs",children:[(0,r.jsx)(l.Ol,{className:"pb-2",children:(0,r.jsx)(l.ll,{className:"text-sm font-medium",children:"Offline Queue"})}),(0,r.jsxs)(l.aY,{className:"flex flex-col gap-2 text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{children:"Queued"}),(0,r.jsx)("span",{className:"font-semibold",children:G})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{children:"Needs Review"}),(0,r.jsx)("span",{className:"font-semibold",children:$})]}),(0,r.jsx)(i.z,{onClick:er,disabled:D||0===G,children:D?"Syncing...":"Sync Now"})]})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsx)(l.ll,{className:"text-sm font-medium",children:"Action"})}),(0,r.jsx)(l.aY,{className:"flex flex-wrap gap-3",children:n.actions.map(e=>(0,r.jsx)(i.z,{variant:g===e?"default":"outline",size:"lg",onClick:()=>j(e),"data-testid":"button-action-".concat(e),children:p[e]},e))})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsx)(l.ll,{className:"text-sm font-medium",children:"Transaction"})}),(0,r.jsxs)(l.aY,{className:"grid gap-4 md:grid-cols-2",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(d._,{htmlFor:"sku",children:"Item SKU"}),(0,r.jsx)(o.I,{id:"sku",ref:M,placeholder:"Scan or type SKU",value:N,onChange:e=>b(e.target.value),onKeyDown:e=>{var t;"Enter"===e.key&&(null===(t=K.current)||void 0===t||t.focus())},"data-testid":"input-station-sku"}),Y&&(0,r.jsxs)("span",{className:"text-xs text-muted-foreground",children:[Y.name," \xb7 Base ",Y.baseUom]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(d._,{htmlFor:"fromLocation",children:"From Location"}),(0,r.jsx)(o.I,{id:"fromLocation",ref:K,placeholder:"Scan from location",value:w,onChange:e=>S(e.target.value),onKeyDown:e=>{var t;"Enter"===e.key&&(null===(t=P.current)||void 0===t||t.focus())},"data-testid":"input-station-from"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(d._,{htmlFor:"toLocation",children:"To Location"}),(0,r.jsx)(o.I,{id:"toLocation",ref:P,placeholder:"Scan to location",value:E,onChange:e=>O(e.target.value),onKeyDown:e=>{var t;"Enter"===e.key&&(null===(t=q.current)||void 0===t||t.focus())},"data-testid":"input-station-to"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(d._,{htmlFor:"qty",children:"Quantity"}),(0,r.jsx)(o.I,{id:"qty",ref:q,placeholder:"Enter quantity",value:R,onChange:e=>T(e.target.value),"data-testid":"input-station-qty"})]}),J.length>1&&(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(d._,{children:"UoM"}),(0,r.jsxs)(c.Ph,{value:C,onValueChange:e=>I(e),children:[(0,r.jsx)(c.i4,{"data-testid":"select-station-uom",children:(0,r.jsx)(c.ki,{placeholder:"Select UoM"})}),(0,r.jsx)(c.Bw,{children:J.map(e=>(0,r.jsx)(c.Ql,{value:e,children:e},e))})]})]}),1===J.length&&(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(d._,{children:"UoM"}),(0,r.jsx)(o.I,{value:J[0],disabled:!0})]}),X&&(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(d._,{children:"Reason Code"}),(0,r.jsxs)(c.Ph,{value:k,onValueChange:_,children:[(0,r.jsx)(c.i4,{"data-testid":"select-station-reason",children:(0,r.jsx)(c.ki,{placeholder:"Select reason"})}),(0,r.jsx)(c.Bw,{children:F.filter(e=>e.type===g).map(e=>(0,r.jsx)(c.Ql,{value:e.id,children:e.code},e.id))})]})]}),(0,r.jsx)("div",{className:"flex items-end",children:(0,r.jsxs)(i.z,{size:"lg",className:"w-full",onClick:en,"data-testid":"button-station-submit",children:["Confirm ",g?p[g]:"Action"]})})]})]}),(G>0||$>0)&&(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsx)(l.ll,{className:"text-sm font-medium",children:"Queued Events"})}),(0,r.jsx)(l.aY,{className:"grid gap-3 text-sm",children:A.map(e=>(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-md border p-3",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("span",{className:"font-medium",children:"queued"===e.status?"Queued":"Needs Review"}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleString()}),e.error&&(0,r.jsx)("span",{className:"text-xs text-destructive",children:e.error})]}),(0,r.jsx)(i.z,{variant:"outline",size:"sm",onClick:()=>{L((0,m.oo)(e.id))},children:"Remove"})]},e.id))})]})]})}function v(e){let{params:t}=e;return(0,r.jsx)(h,{stationId:t.stationId})}},4513:function(e,t,n){"use strict";n.d(t,{z:function(){return d}});var r=n(7437),a=n(2265),s=n(7053),i=n(535),l=n(1216);let o=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover-elevate active-elevate-2",{variants:{variant:{default:"bg-primary text-primary-foreground border border-primary-border",destructive:"bg-destructive text-destructive-foreground border border-destructive-border",outline:" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none ",secondary:"border bg-secondary text-secondary-foreground border border-secondary-border ",ghost:"border border-transparent"},size:{default:"min-h-9 px-4 py-2",sm:"min-h-8 rounded-md px-3 text-xs",lg:"min-h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:n,variant:a,size:i,asChild:d=!1,...c}=e,u=d?s.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(o({variant:a,size:i,className:n})),ref:t,...c})});d.displayName="Button"},1304:function(e,t,n){"use strict";n.d(t,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return i},aY:function(){return c},ll:function(){return o}});var r=n(7437),a=n(2265),s=n(1216);let i=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm",n),...a})});i.displayName="Card";let l=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",n),...a})});l.displayName="CardHeader";let o=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",n),...a})});o.displayName="CardTitle";let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",n),...a})});d.displayName="CardDescription";let c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",n),...a})});c.displayName="CardContent",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",n),...a})}).displayName="CardFooter"},1219:function(e,t,n){"use strict";n.d(t,{I:function(){return i}});var r=n(7437),a=n(2265),s=n(1216);let i=a.forwardRef((e,t)=>{let{className:n,type:a,...i}=e;return(0,r.jsx)("input",{type:a,className:(0,s.cn)("flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:t,...i})});i.displayName="Input"},3579:function(e,t,n){"use strict";n.d(t,{_:function(){return d}});var r=n(7437),a=n(2265),s=n(6394),i=n(535),l=n(1216);let o=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(s.f,{ref:t,className:(0,l.cn)(o(),n),...a})});d.displayName=s.f.displayName},6126:function(e,t,n){"use strict";n.d(t,{Bw:function(){return p},Ph:function(){return c},Ql:function(){return h},i4:function(){return f},ki:function(){return u}});var r=n(7437),a=n(2265),s=n(3402),i=n(875),l=n(2135),o=n(401),d=n(1216);let c=s.fC;s.ZA;let u=s.B4,f=a.forwardRef((e,t)=>{let{className:n,children:a,...l}=e;return(0,r.jsxs)(s.xz,{ref:t,className:(0,d.cn)("flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",n),...l,children:[a,(0,r.jsx)(s.JO,{asChild:!0,children:(0,r.jsx)(i.Z,{className:"h-4 w-4 opacity-50"})})]})});f.displayName=s.xz.displayName;let m=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(s.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",n),...a,children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})});m.displayName=s.u_.displayName;let x=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(s.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",n),...a,children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})});x.displayName=s.$G.displayName;let p=a.forwardRef((e,t)=>{let{className:n,children:a,position:i="popper",...l}=e;return(0,r.jsx)(s.h_,{children:(0,r.jsxs)(s.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:i,...l,children:[(0,r.jsx)(m,{}),(0,r.jsx)(s.l_,{className:(0,d.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,r.jsx)(x,{})]})})});p.displayName=s.VY.displayName,a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(s.__,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",n),...a})}).displayName=s.__.displayName;let h=a.forwardRef((e,t)=>{let{className:n,children:a,...i}=e;return(0,r.jsxs)(s.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(s.wU,{children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(s.eT,{children:a})]})});h.displayName=s.ck.displayName,a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(s.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",n),...a})}).displayName=s.Z0.displayName},9459:function(e,t,n){"use strict";n.d(t,{pm:function(){return f}});var r=n(2265);let a=0,s=new Map,i=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?i(n):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],d={toasts:[]};function c(e){d=l(d,e),o.forEach(e=>{e(d)})}function u(e){let{...t}=e,n=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:n});return c({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:e=>{e||r()}}}),{id:n,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:n}})}}function f(){let[e,t]=r.useState(d);return r.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},3340:function(e,t,n){"use strict";n.d(t,{H:function(){return l},a:function(){return o}});var r=n(7437),a=n(2265),s=n(3196);let i=(0,a.createContext)(void 0);function l(e){let{children:t}=e,[n,l]=(0,a.useState)(null),[o,d]=(0,a.useState)(!0),[c,u]=(0,a.useState)(null),[f,m]=(0,a.useState)([]),x=(0,a.useCallback)(async()=>{try{let n=await fetch("/api/auth/me",{credentials:"include"});if(n.ok){var e,t;let r=await n.json();if(l(r.user),m(r.sites||[]),(null===(e=r.sites)||void 0===e?void 0:e.length)===1)u(r.sites[0]);else{let e=localStorage.getItem("currentSiteId");if(e){let n=null===(t=r.sites)||void 0===t?void 0:t.find(t=>t.id===e);n&&u(n)}}}else l(null),m([]),u(null)}catch(e){l(null)}finally{d(!1)}},[]);(0,a.useEffect)(()=>{x()},[x]);let p=async(e,t)=>{var n;let r=await (0,s.Nv)("POST","/api/auth/login",{email:e,password:t}),a=await r.json();l(a.user),m(a.sites||[]),(null===(n=a.sites)||void 0===n?void 0:n.length)===1&&u(a.sites[0])},h=async()=>{await (0,s.Nv)("POST","/api/auth/logout"),l(null),u(null),m([]),localStorage.removeItem("currentSiteId")};return(0,r.jsx)(i.Provider,{value:{user:n,isLoading:o,isAuthenticated:!!n,currentSite:c,availableSites:f,login:p,logout:h,selectSite:e=>{u(e),localStorage.setItem("currentSiteId",e.id)},refreshUser:x},children:t})}function o(){let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},1119:function(e,t,n){"use strict";n.d(t,{K4:function(){return i},Sg:function(){return a},oo:function(){return o},un:function(){return l}});let r="inventoryEventQueue";function a(){let e=localStorage.getItem(r);if(!e)return[];try{let t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return[]}}function s(e){localStorage.setItem(r,JSON.stringify(e))}function i(e){let t=a();return t.push(e),s(t),t}function l(e,t){let n=a().map(n=>n.id===e?{...n,...t}:n);return s(n),n}function o(e){let t=a().filter(t=>t.id!==e);return s(t),t}},3196:function(e,t,n){"use strict";async function r(e){if(!e.ok){let t=await e.text()||e.statusText;throw Error("".concat(e.status,": ").concat(t))}}async function a(e,t,n){let a=await fetch(t,{method:e,headers:n?{"Content-Type":"application/json"}:{},body:n?JSON.stringify(n):void 0,credentials:"include"});return await r(a),a}n.d(t,{Eh:function(){return s},Nv:function(){return a}});let s=new(n(946)).S({defaultOptions:{queries:{queryFn:(e=>{let{on401:t}=e;return async e=>{let{queryKey:n}=e,a=await fetch(n.join("/"),{credentials:"include"});return"returnNull"===t&&401===a.status?null:(await r(a),await a.json())}})({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:!1},mutations:{retry:!1}}})},1216:function(e,t,n){"use strict";n.d(t,{cn:function(){return s}});var r=n(1994),a=n(3335);function s(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m6)((0,r.W)(t))}},6394:function(e,t,n){"use strict";n.d(t,{f:function(){return l}});var r=n(2265),a=n(6840),s=n(7437),i=r.forwardRef((e,t)=>(0,s.jsx)(a.WV.label,{...e,ref:t,onMouseDown:t=>{var n;t.target.closest("button, input, select, textarea")||(null===(n=e.onMouseDown)||void 0===n||n.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var l=i},535:function(e,t,n){"use strict";n.d(t,{j:function(){return i}});var r=n(1994);let a=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,s=r.W,i=(e,t)=>n=>{var r;if((null==t?void 0:t.variants)==null)return s(e,null==n?void 0:n.class,null==n?void 0:n.className);let{variants:i,defaultVariants:l}=t,o=Object.keys(i).map(e=>{let t=null==n?void 0:n[e],r=null==l?void 0:l[e];if(null===t)return null;let s=a(t)||a(r);return i[e][s]}),d=n&&Object.entries(n).reduce((e,t)=>{let[n,r]=t;return void 0===r||(e[n]=r),e},{});return s(e,o,null==t?void 0:null===(r=t.compoundVariants)||void 0===r?void 0:r.reduce((e,t)=>{let{class:n,className:r,...a}=t;return Object.entries(a).every(e=>{let[t,n]=e;return Array.isArray(n)?n.includes({...l,...d}[t]):({...l,...d})[t]===n})?[...e,n,r]:e},[]),null==n?void 0:n.class,null==n?void 0:n.className)}}},function(e){e.O(0,[454,946,720,661,306,16,763,971,117,744],function(){return e(e.s=4689)}),_N_E=e.O()}]);