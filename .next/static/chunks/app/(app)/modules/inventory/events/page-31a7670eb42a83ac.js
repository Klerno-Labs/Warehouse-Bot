(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[939],{5369:function(e,t,n){Promise.resolve().then(n.bind(n,6083))},6083:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var r=n(7437),a=n(2265),l=n(16),s=n(2533),o=n(1304),i=n(4513),d=n(1219),c=n(6126),u=n(5557),f=n(3340),m=n(102);function p(){let{currentSite:e}=(0,f.a)(),t=(null==e?void 0:e.id)||"",{data:n=[]}=(0,l.a)({queryKey:["/api/inventory/events?siteId=".concat(t)],enabled:!!t}),{data:p=[]}=(0,l.a)({queryKey:["/api/inventory/items"]}),{data:x=[]}=(0,l.a)({queryKey:["/api/inventory/locations?siteId=".concat(t)],enabled:!!t}),h=(0,a.useMemo)(()=>new Map(p.map(e=>[e.id,e])),[p]),b=(0,a.useMemo)(()=>new Map(x.map(e=>[e.id,e])),[x]),[v,g]=(0,a.useState)("all"),[y,j]=(0,a.useState)(""),[w,N]=(0,a.useState)(""),[I,z]=(0,a.useState)(""),[C,R]=(0,a.useState)(""),S=n.filter(e=>{let t=h.get(e.itemId),n=e.fromLocationId?b.get(e.fromLocationId):null,r=e.toLocationId?b.get(e.toLocationId):null,a="all"===v||e.eventType===v,l=!t||"".concat(t.sku," ").concat(t.name).toLowerCase().includes(y.toLowerCase()),s="".concat((null==n?void 0:n.label)||""," ").concat((null==r?void 0:r.label)||"").toLowerCase().includes(w.toLowerCase()),o=new Date(e.createdAt),i=!I||o>=new Date(I),d=!C||o<=new Date(C);return a&&l&&s&&i&&d});return(0,r.jsxs)("div",{className:"flex h-full flex-col",children:[(0,r.jsx)(s.L,{}),(0,r.jsxs)("div",{className:"flex flex-1 flex-col gap-6 p-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold tracking-tight",children:"Event Log"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Append-only inventory event ledger."})]}),(0,r.jsxs)(o.Zb,{children:[(0,r.jsxs)(o.Ol,{children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,r.jsx)(o.ll,{className:"text-sm font-medium",children:"Recent Events"}),(0,r.jsx)(i.z,{variant:"outline",size:"sm",onClick:()=>{let e=new Blob([[["createdAt","eventType","itemSku","itemName","qtyEntered","uomEntered","fromLocation","toLocation"],...S.map(e=>{let t=h.get(e.itemId),n=e.fromLocationId?b.get(e.fromLocationId):null,r=e.toLocationId?b.get(e.toLocationId):null;return[new Date(e.createdAt).toISOString(),e.eventType,(null==t?void 0:t.sku)||"",(null==t?void 0:t.name)||"",String(e.qtyEntered),e.uomEntered,(null==n?void 0:n.label)||"",(null==r?void 0:r.label)||""]})].map(e=>e.map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="inventory-events.csv",t.click(),URL.revokeObjectURL(t.href)},children:"Export CSV"})]}),(0,r.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,r.jsxs)(c.Ph,{value:v,onValueChange:g,children:[(0,r.jsx)(c.i4,{className:"w-[200px]",children:(0,r.jsx)(c.ki,{placeholder:"All event types"})}),(0,r.jsxs)(c.Bw,{children:[(0,r.jsx)(c.Ql,{value:"all",children:"All event types"}),m.E_.map(e=>(0,r.jsx)(c.Ql,{value:e,children:e},e))]})]}),(0,r.jsx)(d.I,{placeholder:"Filter by item",value:y,onChange:e=>j(e.target.value),className:"w-full sm:w-[200px]"}),(0,r.jsx)(d.I,{placeholder:"Filter by location",value:w,onChange:e=>N(e.target.value),className:"w-full sm:w-[200px]"}),(0,r.jsx)(d.I,{type:"date",value:I,onChange:e=>z(e.target.value),className:"w-full sm:w-[170px]"}),(0,r.jsx)(d.I,{type:"date",value:C,onChange:e=>R(e.target.value),className:"w-full sm:w-[170px]"})]})]}),(0,r.jsx)(o.aY,{children:(0,r.jsx)("div",{className:"rounded-md border",children:(0,r.jsxs)(u.iA,{children:[(0,r.jsx)(u.xD,{children:(0,r.jsxs)(u.SC,{children:[(0,r.jsx)(u.ss,{children:"Time"}),(0,r.jsx)(u.ss,{children:"Type"}),(0,r.jsx)(u.ss,{children:"Item"}),(0,r.jsx)(u.ss,{children:"Qty"}),(0,r.jsx)(u.ss,{children:"From"}),(0,r.jsx)(u.ss,{children:"To"})]})}),(0,r.jsx)(u.RM,{children:S.map(e=>{let t=h.get(e.itemId),n=e.fromLocationId?b.get(e.fromLocationId):null,a=e.toLocationId?b.get(e.toLocationId):null;return(0,r.jsxs)(u.SC,{children:[(0,r.jsx)(u.pj,{children:new Date(e.createdAt).toLocaleString()}),(0,r.jsx)(u.pj,{children:e.eventType}),(0,r.jsx)(u.pj,{children:t?"".concat(t.sku," - ").concat(t.name):e.itemId}),(0,r.jsxs)(u.pj,{children:[e.qtyEntered," ",e.uomEntered]}),(0,r.jsx)(u.pj,{children:(null==n?void 0:n.label)||"-"}),(0,r.jsx)(u.pj,{children:(null==a?void 0:a.label)||"-"})]},e.id)})})]})})})]})]})]})}function x(){return(0,r.jsx)(p,{})}},2533:function(e,t,n){"use strict";n.d(t,{L:function(){return i}});var r=n(7437),a=n(7648),l=n(9376),s=n(1216);let o=[{label:"Dashboard",href:"/modules/inventory"},{label:"Items",href:"/modules/inventory/items"},{label:"Locations",href:"/modules/inventory/locations"},{label:"Balances",href:"/modules/inventory/balances"},{label:"Events",href:"/modules/inventory/events"},{label:"Reason Codes",href:"/modules/inventory/reason-codes"}];function i(){let e=(0,l.usePathname)();return(0,r.jsx)("div",{className:"flex flex-wrap gap-2 border-b px-6 pt-4",children:o.map(t=>{let n=e===t.href;return(0,r.jsx)(a.default,{href:t.href,className:(0,s.cn)("inline-flex items-center rounded-md px-3 py-2 text-sm font-medium",n?"bg-accent text-accent-foreground":"text-muted-foreground hover:text-foreground"),children:t.label},t.href)})})}},4513:function(e,t,n){"use strict";n.d(t,{z:function(){return d}});var r=n(7437),a=n(2265),l=n(7053),s=n(535),o=n(1216);let i=(0,s.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover-elevate active-elevate-2",{variants:{variant:{default:"bg-primary text-primary-foreground border border-primary-border",destructive:"bg-destructive text-destructive-foreground border border-destructive-border",outline:" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none ",secondary:"border bg-secondary text-secondary-foreground border border-secondary-border ",ghost:"border border-transparent"},size:{default:"min-h-9 px-4 py-2",sm:"min-h-8 rounded-md px-3 text-xs",lg:"min-h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:n,variant:a,size:s,asChild:d=!1,...c}=e,u=d?l.g7:"button";return(0,r.jsx)(u,{className:(0,o.cn)(i({variant:a,size:s,className:n})),ref:t,...c})});d.displayName="Button"},1304:function(e,t,n){"use strict";n.d(t,{Ol:function(){return o},SZ:function(){return d},Zb:function(){return s},aY:function(){return c},ll:function(){return i}});var r=n(7437),a=n(2265),l=n(1216);let s=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm",n),...a})});s.displayName="Card";let o=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",n),...a})});o.displayName="CardHeader";let i=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",n),...a})});i.displayName="CardTitle";let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",n),...a})});d.displayName="CardDescription";let c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",n),...a})});c.displayName="CardContent",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",n),...a})}).displayName="CardFooter"},1219:function(e,t,n){"use strict";n.d(t,{I:function(){return s}});var r=n(7437),a=n(2265),l=n(1216);let s=a.forwardRef((e,t)=>{let{className:n,type:a,...s}=e;return(0,r.jsx)("input",{type:a,className:(0,l.cn)("flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:t,...s})});s.displayName="Input"},6126:function(e,t,n){"use strict";n.d(t,{Bw:function(){return x},Ph:function(){return c},Ql:function(){return h},i4:function(){return f},ki:function(){return u}});var r=n(7437),a=n(2265),l=n(3402),s=n(875),o=n(2135),i=n(401),d=n(1216);let c=l.fC;l.ZA;let u=l.B4,f=a.forwardRef((e,t)=>{let{className:n,children:a,...o}=e;return(0,r.jsxs)(l.xz,{ref:t,className:(0,d.cn)("flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",n),...o,children:[a,(0,r.jsx)(l.JO,{asChild:!0,children:(0,r.jsx)(s.Z,{className:"h-4 w-4 opacity-50"})})]})});f.displayName=l.xz.displayName;let m=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(l.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",n),...a,children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})})});m.displayName=l.u_.displayName;let p=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(l.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",n),...a,children:(0,r.jsx)(s.Z,{className:"h-4 w-4"})})});p.displayName=l.$G.displayName;let x=a.forwardRef((e,t)=>{let{className:n,children:a,position:s="popper",...o}=e;return(0,r.jsx)(l.h_,{children:(0,r.jsxs)(l.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:s,...o,children:[(0,r.jsx)(m,{}),(0,r.jsx)(l.l_,{className:(0,d.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,r.jsx)(p,{})]})})});x.displayName=l.VY.displayName,a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(l.__,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",n),...a})}).displayName=l.__.displayName;let h=a.forwardRef((e,t)=>{let{className:n,children:a,...s}=e;return(0,r.jsxs)(l.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...s,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(l.wU,{children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(l.eT,{children:a})]})});h.displayName=l.ck.displayName,a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(l.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",n),...a})}).displayName=l.Z0.displayName},5557:function(e,t,n){"use strict";n.d(t,{RM:function(){return i},SC:function(){return d},iA:function(){return s},pj:function(){return u},ss:function(){return c},xD:function(){return o}});var r=n(7437),a=n(2265),l=n(1216);let s=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",n),...a})})});s.displayName="Table";let o=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",n),...a})});o.displayName="TableHeader";let i=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",n),...a})});i.displayName="TableBody",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",n),...a})}).displayName="TableFooter";let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",n),...a})});d.displayName="TableRow";let c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",n),...a})});c.displayName="TableHead";let u=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",n),...a})});u.displayName="TableCell",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",n),...a})}).displayName="TableCaption"},3340:function(e,t,n){"use strict";n.d(t,{H:function(){return o},a:function(){return i}});var r=n(7437),a=n(2265),l=n(3196);let s=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[n,o]=(0,a.useState)(null),[i,d]=(0,a.useState)(!0),[c,u]=(0,a.useState)(null),[f,m]=(0,a.useState)([]),p=(0,a.useCallback)(async()=>{try{let n=await fetch("/api/auth/me",{credentials:"include"});if(n.ok){var e,t;let r=await n.json();if(o(r.user),m(r.sites||[]),(null===(e=r.sites)||void 0===e?void 0:e.length)===1)u(r.sites[0]);else{let e=localStorage.getItem("currentSiteId");if(e){let n=null===(t=r.sites)||void 0===t?void 0:t.find(t=>t.id===e);n&&u(n)}}}else o(null),m([]),u(null)}catch(e){o(null)}finally{d(!1)}},[]);(0,a.useEffect)(()=>{p()},[p]);let x=async(e,t)=>{var n;let r=await (0,l.Nv)("POST","/api/auth/login",{email:e,password:t}),a=await r.json();o(a.user),m(a.sites||[]),(null===(n=a.sites)||void 0===n?void 0:n.length)===1&&u(a.sites[0])},h=async()=>{await (0,l.Nv)("POST","/api/auth/logout"),o(null),u(null),m([]),localStorage.removeItem("currentSiteId")};return(0,r.jsx)(s.Provider,{value:{user:n,isLoading:i,isAuthenticated:!!n,currentSite:c,availableSites:f,login:x,logout:h,selectSite:e=>{u(e),localStorage.setItem("currentSiteId",e.id)},refreshUser:p},children:t})}function i(){let e=(0,a.useContext)(s);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},3196:function(e,t,n){"use strict";async function r(e){if(!e.ok){let t=await e.text()||e.statusText;throw Error("".concat(e.status,": ").concat(t))}}async function a(e,t,n){let a=await fetch(t,{method:e,headers:n?{"Content-Type":"application/json"}:{},body:n?JSON.stringify(n):void 0,credentials:"include"});return await r(a),a}n.d(t,{Eh:function(){return l},Nv:function(){return a}});let l=new(n(946)).S({defaultOptions:{queries:{queryFn:(e=>{let{on401:t}=e;return async e=>{let{queryKey:n}=e,a=await fetch(n.join("/"),{credentials:"include"});return"returnNull"===t&&401===a.status?null:(await r(a),await a.json())}})({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:!1},mutations:{retry:!1}}})},1216:function(e,t,n){"use strict";n.d(t,{cn:function(){return l}});var r=n(1994),a=n(3335);function l(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m6)((0,r.W)(t))}},102:function(e,t,n){"use strict";n.d(t,{Bq:function(){return s},Cs:function(){return a},E_:function(){return i},o:function(){return l},wA:function(){return o}});var r=n(1229);let a=["EA","FT","YD","ROLL"],l=["PRODUCTION","PACKAGING","FACILITY","CHEMICAL_MRO"],s=["RECEIVING","STOCK","WIP","QC_HOLD","SHIPPING"],o=["SCRAP","ADJUST","HOLD"],i=["RECEIVE","MOVE","ISSUE_TO_WORKCELL","RETURN","SCRAP","HOLD","RELEASE","COUNT","ADJUST"],d=r.z.object({uom:r.z.enum(a),toBase:r.z.number().positive()});r.z.object({sku:r.z.string().min(1),name:r.z.string().min(1),description:r.z.string().optional(),category:r.z.enum(l),baseUom:r.z.enum(a),allowedUoms:r.z.array(d).min(1),minQtyBase:r.z.number().optional(),maxQtyBase:r.z.number().optional(),reorderPointBase:r.z.number().optional(),leadTimeDays:r.z.number().int().optional()}).partial(),r.z.object({siteId:r.z.string().min(1),zone:r.z.string().optional(),bin:r.z.string().optional(),label:r.z.string().min(1),type:r.z.enum(s).optional()}).partial(),r.z.object({type:r.z.enum(o),code:r.z.string().min(1),description:r.z.string().optional()}).partial(),r.z.object({siteId:r.z.string().min(1),eventType:r.z.enum(i),itemId:r.z.string().min(1),qtyEntered:r.z.number().positive(),uomEntered:r.z.enum(a),fromLocationId:r.z.string().optional(),toLocationId:r.z.string().optional(),workcellId:r.z.string().optional(),referenceId:r.z.string().optional(),reasonCodeId:r.z.string().optional(),notes:r.z.string().optional(),deviceId:r.z.string().optional()})}},function(e){e.O(0,[454,946,720,661,306,648,16,763,183,971,117,744],function(){return e(e.s=5369)}),_N_E=e.O()}]);