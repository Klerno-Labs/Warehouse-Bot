"use strict";(()=>{var e={};e.id=58,e.ids=[58],e.modules={7096:e=>{e.exports=require("bcrypt")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},4162:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>v,routeModule:()=>j,serverHooks:()=>y,staticGenerationAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{GET:()=>x,POST:()=>m});var n=r(9303),a=r(8716),i=r(670),o=r(7070),u=r(7096),p=r.n(u),d=r(7630),l=r(5010),c=r(7773);async function x(){let e=await (0,c.a8)();if(!e)return o.NextResponse.json({error:"Unauthorized"},{status:401});if(!["Admin","Supervisor"].includes(e.user.role))return o.NextResponse.json({error:"Forbidden"},{status:403});let t=(await d.t.getUsersByTenant(e.user.tenantId)).map(({password:e,...t})=>t);return o.NextResponse.json(t)}async function m(e){let t=await (0,c.a8)();if(!t)return o.NextResponse.json({error:"Unauthorized"},{status:401});if("Admin"!==t.user.role)return o.NextResponse.json({error:"Forbidden"},{status:403});let{email:r,password:s,firstName:n,lastName:a,role:i,siteIds:u}=await e.json();if(await d.t.getUserByEmail(r))return o.NextResponse.json({error:"Email already exists"},{status:409});let x=await p().hash(s,10),m=await d.t.createUser({tenantId:t.user.tenantId,email:r,password:x,firstName:n,lastName:a,role:i||"Viewer",siteIds:u||[],isActive:!0});await (0,l.U)(t.user.tenantId,t.user.id,"CREATE","User",m.id,`Created user ${m.email}`);let{password:j,...v}=m;return o.NextResponse.json(v,{status:201})}let j=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/users/route",pathname:"/api/users",filename:"route",bundlePath:"app/api/users/route"},resolvedPagePath:"C:\\Users\\Somli\\OneDrive\\Desktop\\My Apps\\Warehouse Builder\\app\\api\\users\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:w,serverHooks:y}=j,g="/api/users/route";function h(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:w})}},5010:(e,t,r)=>{r.d(t,{U:()=>n});var s=r(7630);async function n(e,t,r,n,a,i,o){await s.t.createAuditEvent({tenantId:e,userId:t,action:r,entityType:n,entityId:a,details:i,ipAddress:o||null})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,564,773],()=>r(4162));module.exports=s})();