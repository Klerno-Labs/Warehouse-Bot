"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={7096:e=>{e.exports=require("bcrypt")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},9461:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>q,requestAsyncStorage:()=>h,routeModule:()=>v,serverHooks:()=>y,staticGenerationAsyncStorage:()=>j});var s={};r.r(s),r.d(s,{POST:()=>m});var a=r(9303),n=r(8716),i=r(670),o=r(7070),u=r(7096),p=r.n(u),d=r(7410);let l=d.z.object({email:d.z.string().email("Invalid email address"),password:d.z.string().min(1,"Password is required")});var c=r(7630),x=r(5010),g=r(7773);async function m(e){try{let t=l.parse(await e.json()),r=await c.t.getUserByEmail(t.email);if(!r||!p().compareSync(t.password,r.password))return o.NextResponse.json({error:"Invalid email or password"},{status:401});if(!r.isActive)return o.NextResponse.json({error:"Account is deactivated"},{status:403});(0,g.Uj)(r.id);let s=await c.t.getSessionUser(r.id),a=await c.t.getSitesForUser(r.id);return await (0,x.U)(r.tenantId,r.id,"LOGIN","Session",null,"User logged in successfully"),o.NextResponse.json({user:s,sites:a})}catch(e){if(e instanceof d.z.ZodError)return o.NextResponse.json({error:"Invalid request",details:e.errors},{status:400});return o.NextResponse.json({error:"Internal server error"},{status:500})}}let v=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\Somli\\OneDrive\\Desktop\\My Apps\\Warehouse Builder\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:j,serverHooks:y}=v,w="/api/auth/login/route";function q(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:j})}},5010:(e,t,r)=>{r.d(t,{U:()=>a});var s=r(7630);async function a(e,t,r,a,n,i,o){await s.t.createAuditEvent({tenantId:e,userId:t,action:r,entityType:a,entityId:n,details:i,ipAddress:o||null})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,564,410,773],()=>r(9461));module.exports=s})();