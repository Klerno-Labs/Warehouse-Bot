(()=>{var e={};e.id=544,e.ids=[544],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4490:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>r.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),s(4281),s(7210),s(4752),s(6560);var a=s(3191),i=s(8716),n=s(7922),r=s.n(n),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d=["",{children:["(app)",{children:["stations",{children:["[stationId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,4281)),"C:\\Users\\Somli\\OneDrive\\Desktop\\My Apps\\Warehouse Builder\\app\\(app)\\stations\\[stationId]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,7210)),"C:\\Users\\Somli\\OneDrive\\Desktop\\My Apps\\Warehouse Builder\\app\\(app)\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,4752)),"C:\\Users\\Somli\\OneDrive\\Desktop\\My Apps\\Warehouse Builder\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,6560)),"C:\\Users\\Somli\\OneDrive\\Desktop\\My Apps\\Warehouse Builder\\app\\not-found.tsx"]}],c=["C:\\Users\\Somli\\OneDrive\\Desktop\\My Apps\\Warehouse Builder\\app\\(app)\\stations\\[stationId]\\page.tsx"],u="/(app)/stations/[stationId]/page",m={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(app)/stations/[stationId]/page",pathname:"/stations/[stationId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},2173:(e,t,s)=>{Promise.resolve().then(s.bind(s,3664))},3664:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>v});var a=s(326),i=s(7577),n=s(7276),r=s(2961),l=s(1563),o=s(1206),d=s(9340),c=s(6097),u=s(6598),m=s(5770);function p(e){let t=[];return t.push(e),t}function x(e){return[].filter(t=>t.id!==e)}let f={receiving:{label:"Receiving",actions:["RECEIVE","MOVE","HOLD"],workcellName:"Receiving Dock 1"},stockroom:{label:"Stockroom / Kitting",actions:["MOVE","ISSUE_TO_WORKCELL","RETURN"],workcellName:"Kitting Station A"},pleater1:{label:"Pleater 1",actions:["ISSUE_TO_WORKCELL","RETURN"],workcellName:"Pleater 1"},packing:{label:"Packing / Shipping",actions:["MOVE","RETURN"],workcellName:"Packing Station 1"}},h={RECEIVE:"Receive",MOVE:"Move",ISSUE_TO_WORKCELL:"Issue to Workcell",RETURN:"Return",SCRAP:"Scrap",HOLD:"Hold",RELEASE:"Release",COUNT:"Count",ADJUST:"Adjust"};function j({stationId:e}){let t=f[e||""],{currentSite:s,user:j}=(0,m.a)(),{toast:v}=(0,u.pm)(),[g,y]=(0,i.useState)(""),[N,w]=(0,i.useState)(""),[S,b]=(0,i.useState)(""),[E,R]=(0,i.useState)(""),[C,k]=(0,i.useState)(""),[O,_]=(0,i.useState)(""),[I,L]=(0,i.useState)(""),[U,D]=(0,i.useState)(()=>[]),[A,P]=(0,i.useState)(!1),M=(0,i.useRef)(null),T=(0,i.useRef)(null),q=(0,i.useRef)(null),K=(0,i.useRef)(null),V=s?.id||"",{data:Z=[]}=(0,n.a)({queryKey:["/api/inventory/items"]}),{data:z=[]}=(0,n.a)({queryKey:[`/api/inventory/locations?siteId=${V}`],enabled:!!V}),{data:W=[]}=(0,n.a)({queryKey:["/api/inventory/reason-codes"]}),{data:B=[]}=(0,n.a)({queryKey:[`/api/sites/${V}/workcells`],enabled:!!V}),Y=(0,i.useMemo)(()=>Z.find(e=>e.sku.toLowerCase()===N.trim().toLowerCase()),[Z,N]),$=(0,i.useMemo)(()=>z.find(e=>e.label.toLowerCase()===S.trim().toLowerCase()),[z,S]),Q=(0,i.useMemo)(()=>z.find(e=>e.label.toLowerCase()===E.trim().toLowerCase()),[z,E]),F=Y?.allowedUoms.map(e=>e.uom)||[],G=(0,i.useMemo)(()=>t&&B.find(e=>e.name===t.workcellName)?.id||null,[B,t]),H=U.filter(e=>"queued"===e.status).length,J=U.filter(e=>"needs-review"===e.status).length;if(!t)return a.jsx("div",{className:"flex h-full items-center justify-center p-6",children:a.jsx(l.Zb,{className:"max-w-md text-center",children:(0,a.jsxs)(l.aY,{className:"py-12",children:[a.jsx("h3",{className:"text-lg font-medium",children:"Station Not Found"}),a.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"The requested station does not exist."})]})})});if(j&&!["Operator","Inventory","Supervisor","Admin"].includes(j.role))return a.jsx("div",{className:"flex h-full items-center justify-center p-6",children:a.jsx(l.Zb,{className:"max-w-md text-center",children:(0,a.jsxs)(l.aY,{className:"py-12",children:[a.jsx("h3",{className:"text-lg font-medium",children:"Access Denied"}),a.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Your role does not have access to station mode."})]})})});let X="SCRAP"===g||"ADJUST"===g||"HOLD"===g,ee=()=>{w(""),b(""),R(""),k(""),_(""),L(""),setTimeout(()=>M.current?.focus(),0)},et=()=>{if(!V)return v({title:"No site selected",variant:"destructive"}),null;if(!g)return v({title:"Select an action",variant:"destructive"}),null;if(!Y)return v({title:"Item not found",description:"Scan a valid SKU",variant:"destructive"}),null;if(!O)return v({title:"Select a UoM",variant:"destructive"}),null;if(!C||Number.isNaN(Number(C)))return v({title:"Enter a valid quantity",variant:"destructive"}),null;if(!$&&["MOVE","ISSUE_TO_WORKCELL","RETURN","SCRAP","HOLD","RELEASE"].includes(g))return v({title:"Scan from location",variant:"destructive"}),null;if(!Q&&["RECEIVE","MOVE","ISSUE_TO_WORKCELL","RETURN","HOLD","RELEASE","COUNT"].includes(g))return v({title:"Scan to location",variant:"destructive"}),null;let e={siteId:V,eventType:g,itemId:Y.id,qtyEntered:Number(C),uomEntered:O,fromLocationId:$?.id,toLocationId:Q?.id,workcellId:G,reasonCodeId:I||void 0};return X&&!I?(v({title:"Reason code required",variant:"destructive"}),null):e},es=async()=>{let e=et();if(e)try{let t=await fetch("/api/inventory/events",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok){let s=await t.text(),a={id:`${Date.now()}-${Math.random().toString(36).slice(2,9)}`,payload:e,status:"needs-review",error:s,createdAt:new Date().toISOString()},i=p(a);D(i),v({title:"Needs review",description:"Server rejected the event. Saved for review.",variant:"destructive"});return}v({title:"Event recorded"}),ee()}catch(t){D(p({id:`${Date.now()}-${Math.random().toString(36).slice(2,9)}`,payload:e,status:"queued",createdAt:new Date().toISOString()})),v({title:"Offline",description:"Event queued for sync."})}},ea=async()=>{P(!0);let e=[];for(let t of e)if("queued"===t.status)try{let s=await fetch("/api/inventory/events",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t.payload)});if(!s.ok){let a=await s.text();e=function(e,t){return[].map(s=>s.id===e?{...s,...t}:s)}(t.id,{status:"needs-review",error:a});continue}e=x(t.id)}catch{break}D(e),P(!1)};return(0,a.jsxs)("div",{className:"flex h-full flex-col gap-6 p-6",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl font-semibold tracking-tight",children:[t.label," Station"]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Scan and transact inventory with minimal taps."})]}),(0,a.jsxs)(l.Zb,{className:"w-full max-w-xs",children:[a.jsx(l.Ol,{className:"pb-2",children:a.jsx(l.ll,{className:"text-sm font-medium",children:"Offline Queue"})}),(0,a.jsxs)(l.aY,{className:"flex flex-col gap-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{children:"Queued"}),a.jsx("span",{className:"font-semibold",children:H})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{children:"Needs Review"}),a.jsx("span",{className:"font-semibold",children:J})]}),a.jsx(r.z,{onClick:ea,disabled:A||0===H,children:A?"Syncing...":"Sync Now"})]})]})]}),(0,a.jsxs)(l.Zb,{children:[a.jsx(l.Ol,{children:a.jsx(l.ll,{className:"text-sm font-medium",children:"Action"})}),a.jsx(l.aY,{className:"flex flex-wrap gap-3",children:t.actions.map(e=>a.jsx(r.z,{variant:g===e?"default":"outline",size:"lg",onClick:()=>y(e),"data-testid":`button-action-${e}`,children:h[e]},e))})]}),(0,a.jsxs)(l.Zb,{children:[a.jsx(l.Ol,{children:a.jsx(l.ll,{className:"text-sm font-medium",children:"Transaction"})}),(0,a.jsxs)(l.aY,{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[a.jsx(d._,{htmlFor:"sku",children:"Item SKU"}),a.jsx(o.I,{id:"sku",ref:M,placeholder:"Scan or type SKU",value:N,onChange:e=>w(e.target.value),onKeyDown:e=>{"Enter"===e.key&&T.current?.focus()},"data-testid":"input-station-sku"}),Y&&(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[Y.name," \xb7 Base ",Y.baseUom]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[a.jsx(d._,{htmlFor:"fromLocation",children:"From Location"}),a.jsx(o.I,{id:"fromLocation",ref:T,placeholder:"Scan from location",value:S,onChange:e=>b(e.target.value),onKeyDown:e=>{"Enter"===e.key&&q.current?.focus()},"data-testid":"input-station-from"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[a.jsx(d._,{htmlFor:"toLocation",children:"To Location"}),a.jsx(o.I,{id:"toLocation",ref:q,placeholder:"Scan to location",value:E,onChange:e=>R(e.target.value),onKeyDown:e=>{"Enter"===e.key&&K.current?.focus()},"data-testid":"input-station-to"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[a.jsx(d._,{htmlFor:"qty",children:"Quantity"}),a.jsx(o.I,{id:"qty",ref:K,placeholder:"Enter quantity",value:C,onChange:e=>k(e.target.value),"data-testid":"input-station-qty"})]}),F.length>1&&(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[a.jsx(d._,{children:"UoM"}),(0,a.jsxs)(c.Ph,{value:O,onValueChange:e=>_(e),children:[a.jsx(c.i4,{"data-testid":"select-station-uom",children:a.jsx(c.ki,{placeholder:"Select UoM"})}),a.jsx(c.Bw,{children:F.map(e=>a.jsx(c.Ql,{value:e,children:e},e))})]})]}),1===F.length&&(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[a.jsx(d._,{children:"UoM"}),a.jsx(o.I,{value:F[0],disabled:!0})]}),X&&(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[a.jsx(d._,{children:"Reason Code"}),(0,a.jsxs)(c.Ph,{value:I,onValueChange:L,children:[a.jsx(c.i4,{"data-testid":"select-station-reason",children:a.jsx(c.ki,{placeholder:"Select reason"})}),a.jsx(c.Bw,{children:W.filter(e=>e.type===g).map(e=>a.jsx(c.Ql,{value:e.id,children:e.code},e.id))})]})]}),a.jsx("div",{className:"flex items-end",children:(0,a.jsxs)(r.z,{size:"lg",className:"w-full",onClick:es,"data-testid":"button-station-submit",children:["Confirm ",g?h[g]:"Action"]})})]})]}),(H>0||J>0)&&(0,a.jsxs)(l.Zb,{children:[a.jsx(l.Ol,{children:a.jsx(l.ll,{className:"text-sm font-medium",children:"Queued Events"})}),a.jsx(l.aY,{className:"grid gap-3 text-sm",children:U.map(e=>(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-md border p-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{className:"font-medium",children:"queued"===e.status?"Queued":"Needs Review"}),a.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleString()}),e.error&&a.jsx("span",{className:"text-xs text-destructive",children:e.error})]}),a.jsx(r.z,{variant:"outline",size:"sm",onClick:()=>{D(x(e.id))},children:"Remove"})]},e.id))})]})]})}function v({params:e}){return a.jsx(j,{stationId:e.stationId})}},6097:(e,t,s)=>{"use strict";s.d(t,{Bw:()=>f,Ph:()=>c,Ql:()=>h,i4:()=>m,ki:()=>u});var a=s(326),i=s(7577),n=s(8792),r=s(8393),l=s(6633),o=s(2933),d=s(7678);let c=n.fC;n.ZA;let u=n.B4,m=i.forwardRef(({className:e,children:t,...s},i)=>(0,a.jsxs)(n.xz,{ref:i,className:(0,d.cn)("flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[t,a.jsx(n.JO,{asChild:!0,children:a.jsx(r.Z,{className:"h-4 w-4 opacity-50"})})]}));m.displayName=n.xz.displayName;let p=i.forwardRef(({className:e,...t},s)=>a.jsx(n.u_,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(l.Z,{className:"h-4 w-4"})}));p.displayName=n.u_.displayName;let x=i.forwardRef(({className:e,...t},s)=>a.jsx(n.$G,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(r.Z,{className:"h-4 w-4"})}));x.displayName=n.$G.displayName;let f=i.forwardRef(({className:e,children:t,position:s="popper",...i},r)=>a.jsx(n.h_,{children:(0,a.jsxs)(n.VY,{ref:r,className:(0,d.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...i,children:[a.jsx(p,{}),a.jsx(n.l_,{className:(0,d.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),a.jsx(x,{})]})}));f.displayName=n.VY.displayName,i.forwardRef(({className:e,...t},s)=>a.jsx(n.__,{ref:s,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=n.__.displayName;let h=i.forwardRef(({className:e,children:t,...s},i)=>(0,a.jsxs)(n.ck,{ref:i,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(n.wU,{children:a.jsx(o.Z,{className:"h-4 w-4"})})}),a.jsx(n.eT,{children:t})]}));h.displayName=n.ck.displayName,i.forwardRef(({className:e,...t},s)=>a.jsx(n.Z0,{ref:s,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=n.Z0.displayName},4281:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(8570).createProxy)(String.raw`C:\Users\Somli\OneDrive\Desktop\My Apps\Warehouse Builder\app\(app)\stations\[stationId]\page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,32,84,653,360,535],()=>s(4490));module.exports=a})();