"use strict";exports.id=773,exports.ids=[773],exports.modules={7773:(e,t,s)=>{s.d(t,{Rf:()=>u,Uj:()=>c,a8:()=>y,xn:()=>m});var n=s(1615),a=s(4770),r=s.n(a),i=s(7630);let l="wb_session";function o(e,t){let[s,n]=e.split(".");if(!s||!n)return null;let a=r().createHmac("sha256",t).update(s).digest("base64url");if(!r().timingSafeEqual(Buffer.from(n),Buffer.from(a)))return null;let i=JSON.parse(Buffer.from(s,"base64url").toString("utf-8"));return!i.userId||Date.now()>i.exp?null:i}function d(){return process.env.SESSION_SECRET||"warehouse-core-dev-secret"}function c(e){let t=function(e,t){let s=JSON.stringify(e),n=Buffer.from(s).toString("base64url"),a=r().createHmac("sha256",t).update(n).digest("base64url");return`${n}.${a}`}({userId:e,exp:Date.now()+864e5},d());(0,n.cookies)().set(l,t,{httpOnly:!0,sameSite:"lax",secure:!0,maxAge:86400,path:"/"})}function u(){(0,n.cookies)().set(l,"",{maxAge:0,path:"/"})}async function m(){let e=n.cookies().get(l)?.value;if(!e)return null;let t=o(e,d());return t?i.t.getSessionUser(t.userId):null}async function y(){let e=n.cookies().get(l)?.value;if(!e)return null;let t=o(e,d());if(!t)return null;let s=await i.t.getUser(t.userId);if(!s)return null;let a=await i.t.getSessionUser(t.userId);return a?{user:s,sessionUser:a}:null}},7630:(e,t,s)=>{s.d(t,{t:()=>l});var n=s(4770),a=s(7096),r=s.n(a);class i{constructor(){this.users=new Map,this.tenants=new Map,this.sites=new Map,this.departments=new Map,this.workcells=new Map,this.devices=new Map,this.badges=new Map,this.auditEvents=new Map,this.items=new Map,this.locations=new Map,this.reasonCodes=new Map,this.inventoryEvents=new Map,this.inventoryBalances=new Map,this.seedData()}seedData(){let e=(0,n.randomUUID)();this.tenants.set(e,{id:e,name:"Acme Warehouse",slug:"acme",enabledModules:["inventory","jobs","purchasing","cycle-counts","maintenance","sales-atp","dashboards"]});let t=(0,n.randomUUID)();this.sites.set(t,{id:t,tenantId:e,name:"Main Warehouse",address:"123 Industrial Way, City, ST 12345"});let s=(0,n.randomUUID)();this.sites.set(s,{id:s,tenantId:e,name:"Distribution Center",address:"456 Logistics Blvd, City, ST 12345"});let a={};[{name:"Receiving",siteId:t},{name:"Stockroom/Kitting",siteId:t},{name:"Production",siteId:t},{name:"Packing/Shipping",siteId:t}].forEach(t=>{let s=(0,n.randomUUID)(),r={id:s,tenantId:e,siteId:t.siteId,name:t.name};this.departments.set(s,r),a[t.name]=s});let i={};[{name:"Receiving Dock 1",dept:"Receiving",description:"Primary receiving dock"},{name:"Receiving Dock 2",dept:"Receiving",description:"Secondary receiving dock"},{name:"Kitting Station A",dept:"Stockroom/Kitting",description:"Main kitting area"},{name:"Kitting Station B",dept:"Stockroom/Kitting",description:"Secondary kitting"},{name:"Pleater 1",dept:"Production",description:"Primary pleating machine"},{name:"Assembly Line 1",dept:"Production",description:"Main assembly line"},{name:"Packing Station 1",dept:"Packing/Shipping",description:"Primary packing"},{name:"Shipping Dock",dept:"Packing/Shipping",description:"Outbound shipping"}].forEach(s=>{let r=(0,n.randomUUID)(),l={id:r,tenantId:e,siteId:t,departmentId:a[s.dept]||null,name:s.name,description:s.description,status:"active"};this.workcells.set(r,l),i[s.name]=r}),[{name:"Scanner RD1-A",type:"barcode_scanner",workcell:"Receiving Dock 1"},{name:"Scale RD1-B",type:"scale",workcell:"Receiving Dock 1"},{name:"Scanner KIT-A1",type:"barcode_scanner",workcell:"Kitting Station A"},{name:"Printer KIT-A2",type:"label_printer",workcell:"Kitting Station A"},{name:"PLC Pleater 1",type:"plc",workcell:"Pleater 1"},{name:"HMI Pleater 1",type:"hmi",workcell:"Pleater 1"}].forEach(s=>{let a=(0,n.randomUUID)(),r={id:a,tenantId:e,siteId:t,workcellId:i[s.workcell]||null,name:s.name,type:s.type,serialNumber:`SN-${Math.random().toString(36).substr(2,9).toUpperCase()}`,status:"online"};this.devices.set(a,r)}),[{tenantId:e,sku:"PAPER-MEDIA",name:"Paper Media",description:"Pleater paper rolls",category:"PRODUCTION",baseUom:"FT",allowedUoms:[{uom:"FT",toBase:1},{uom:"YD",toBase:3},{uom:"ROLL",toBase:100}],minQtyBase:null,maxQtyBase:null,reorderPointBase:null,leadTimeDays:null},{tenantId:e,sku:"CAPS",name:"Caps",description:"End caps",category:"PACKAGING",baseUom:"EA",allowedUoms:[{uom:"EA",toBase:1}],minQtyBase:null,maxQtyBase:null,reorderPointBase:null,leadTimeDays:null},{tenantId:e,sku:"CORE-MAT",name:"Core Material",description:"Core material",category:"PRODUCTION",baseUom:"FT",allowedUoms:[{uom:"FT",toBase:1}],minQtyBase:null,maxQtyBase:null,reorderPointBase:null,leadTimeDays:null}].forEach(e=>{let t=(0,n.randomUUID)();this.items.set(t,{...e,id:t})}),[{tenantId:e,siteId:t,zone:"RECEIVING",bin:"01",label:"RECEIVING-01",type:"RECEIVING"},{tenantId:e,siteId:t,zone:"STOCK",bin:"A1",label:"STOCK-A1",type:"STOCK"},{tenantId:e,siteId:t,zone:"PLEATER",bin:"STAGE",label:"PLEATER-STAGE",type:"WIP"}].forEach(e=>{let t=(0,n.randomUUID)();this.locations.set(t,{...e,id:t})}),[{tenantId:e,type:"SCRAP",code:"SCRAP-DAMAGE",description:"Damaged material"},{tenantId:e,type:"ADJUST",code:"ADJUST-AUDIT",description:"Audit correction"},{tenantId:e,type:"HOLD",code:"HOLD-QC",description:"QC hold"}].forEach(e=>{let t=(0,n.randomUUID)();this.reasonCodes.set(t,{...e,id:t})});let l=r().hashSync("password123",10),o=(0,n.randomUUID)();this.users.set(o,{id:o,tenantId:e,email:"admin@example.com",password:l,firstName:"John",lastName:"Admin",role:"Admin",siteIds:[t,s],isActive:!0}),[{email:"sarah.j@example.com",firstName:"Sarah",lastName:"Johnson",role:"Supervisor"},{email:"mike.w@example.com",firstName:"Mike",lastName:"Wilson",role:"Inventory"},{email:"emily.d@example.com",firstName:"Emily",lastName:"Davis",role:"Operator"},{email:"tom.b@example.com",firstName:"Tom",lastName:"Brown",role:"Viewer"}].forEach(s=>{let a=(0,n.randomUUID)(),r={id:a,tenantId:e,email:s.email,password:l,firstName:s.firstName,lastName:s.lastName,role:s.role,siteIds:[t],isActive:!0};this.users.set(a,r)}),[{action:"CREATE",entityType:"Tenant",entityId:e,details:"Initial tenant setup"},{action:"CREATE",entityType:"Site",entityId:t,details:"Main warehouse created"},{action:"CREATE",entityType:"User",entityId:o,details:"Admin user created"}].forEach(t=>{let s=(0,n.randomUUID)(),a={id:s,tenantId:e,userId:o,action:t.action,entityType:t.entityType,entityId:t.entityId,details:t.details,ipAddress:"127.0.0.1",timestamp:new Date};this.auditEvents.set(s,a)})}async getUser(e){return this.users.get(e)}async getUserByEmail(e){return Array.from(this.users.values()).find(t=>t.email===e)}async createUser(e){let t=(0,n.randomUUID)(),s={id:t,tenantId:e.tenantId,email:e.email,password:e.password,firstName:e.firstName,lastName:e.lastName,role:e.role||"Viewer",siteIds:e.siteIds||[],isActive:e.isActive??!0};return this.users.set(t,s),s}async getUsersByTenant(e){return Array.from(this.users.values()).filter(t=>t.tenantId===e)}async updateUser(e,t){let s=this.users.get(e);if(!s)return;let n={...s,...t};return this.users.set(e,n),n}async getTenant(e){return this.tenants.get(e)}async getTenantBySlug(e){return Array.from(this.tenants.values()).find(t=>t.slug===e)}async createTenant(e){let t=(0,n.randomUUID)(),s={id:t,name:e.name,slug:e.slug,enabledModules:e.enabledModules||[]};return this.tenants.set(t,s),s}async updateTenant(e,t){let s=this.tenants.get(e);if(!s)return;let n={...s,...t};return this.tenants.set(e,n),n}async getTenantsForUser(e){let t=this.users.get(e);if(!t)return[];let s=this.tenants.get(t.tenantId);if(!s)return[];let n=await this.getSitesForUser(e);return[{...s,sites:n}]}async getSite(e){return this.sites.get(e)}async getSitesByTenant(e){return Array.from(this.sites.values()).filter(t=>t.tenantId===e)}async createSite(e){let t=(0,n.randomUUID)(),s={id:t,tenantId:e.tenantId,name:e.name,address:e.address??null};return this.sites.set(t,s),s}async updateSite(e,t){let s=this.sites.get(e);if(!s)return;let n={...s,...t};return this.sites.set(e,n),n}async getSitesForUser(e){let t=this.users.get(e);return t?Array.from(this.sites.values()).filter(e=>e.tenantId===t.tenantId&&t.siteIds.includes(e.id)):[]}async getDepartment(e){return this.departments.get(e)}async getDepartmentsBySite(e){return Array.from(this.departments.values()).filter(t=>t.siteId===e)}async createDepartment(e){let t=(0,n.randomUUID)(),s={...e,id:t};return this.departments.set(t,s),s}async getWorkcell(e){return this.workcells.get(e)}async getWorkcellsBySite(e){return Array.from(this.workcells.values()).filter(t=>t.siteId===e)}async getWorkcellsByDepartment(e){return Array.from(this.workcells.values()).filter(t=>t.departmentId===e)}async createWorkcell(e){let t=(0,n.randomUUID)(),s={id:t,tenantId:e.tenantId,siteId:e.siteId,departmentId:e.departmentId||null,name:e.name,description:e.description||null,status:e.status||"active"};return this.workcells.set(t,s),s}async updateWorkcell(e,t){let s=this.workcells.get(e);if(!s)return;let n={...s,...t};return this.workcells.set(e,n),n}async getDevice(e){return this.devices.get(e)}async getDevicesByWorkcell(e){return Array.from(this.devices.values()).filter(t=>t.workcellId===e)}async getDevicesBySite(e){return Array.from(this.devices.values()).filter(t=>t.siteId===e)}async createDevice(e){let t=(0,n.randomUUID)(),s={id:t,tenantId:e.tenantId,siteId:e.siteId,workcellId:e.workcellId||null,name:e.name,type:e.type,serialNumber:e.serialNumber||null,status:e.status||"online"};return this.devices.set(t,s),s}async updateDevice(e,t){let s=this.devices.get(e);if(!s)return;let n={...s,...t};return this.devices.set(e,n),n}async getBadge(e){return this.badges.get(e)}async getBadgeByNumber(e,t){return Array.from(this.badges.values()).find(s=>s.badgeNumber===e&&s.tenantId===t)}async getBadgesByUser(e){return Array.from(this.badges.values()).filter(t=>t.userId===e)}async createBadge(e){let t=(0,n.randomUUID)(),s={id:t,tenantId:e.tenantId,userId:e.userId,badgeNumber:e.badgeNumber,isActive:e.isActive??!0};return this.badges.set(t,s),s}async createAuditEvent(e){let t=(0,n.randomUUID)(),s={id:t,tenantId:e.tenantId,userId:e.userId??null,action:e.action,entityType:e.entityType,entityId:e.entityId??null,details:e.details??null,ipAddress:e.ipAddress??null,timestamp:new Date};return this.auditEvents.set(t,s),s}async getAuditEvents(e,t=50){return Array.from(this.auditEvents.values()).filter(t=>t.tenantId===e).sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()).slice(0,t)}async getAuditEventsByEntity(e,t){return Array.from(this.auditEvents.values()).filter(s=>s.entityType===e&&s.entityId===t).sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime())}async getItemsByTenant(e){return Array.from(this.items.values()).filter(t=>t.tenantId===e)}async getItemById(e){return this.items.get(e)}async getItemBySku(e,t){return Array.from(this.items.values()).find(s=>s.tenantId===e&&s.sku.toLowerCase()===t.toLowerCase())}async createItem(e){let t=(0,n.randomUUID)(),s={...e,id:t};return this.items.set(t,s),s}async updateItem(e,t){let s=this.items.get(e);if(!s)return;let n={...s,...t};return this.items.set(e,n),n}async getLocationsBySite(e){return Array.from(this.locations.values()).filter(t=>t.siteId===e)}async getLocationById(e){return this.locations.get(e)}async getLocationByLabel(e,t){return Array.from(this.locations.values()).find(s=>s.siteId===e&&s.label.toLowerCase()===t.toLowerCase())}async createLocation(e){let t=(0,n.randomUUID)(),s={...e,id:t};return this.locations.set(t,s),s}async updateLocation(e,t){let s=this.locations.get(e);if(!s)return;let n={...s,...t};return this.locations.set(e,n),n}async getReasonCodesByTenant(e){return Array.from(this.reasonCodes.values()).filter(t=>t.tenantId===e)}async getReasonCodeById(e){return this.reasonCodes.get(e)}async createReasonCode(e){let t=(0,n.randomUUID)(),s={...e,id:t};return this.reasonCodes.set(t,s),s}async updateReasonCode(e,t){let s=this.reasonCodes.get(e);if(!s)return;let n={...s,...t};return this.reasonCodes.set(e,n),n}async createInventoryEvent(e){let t=(0,n.randomUUID)(),s={...e,id:t,createdAt:new Date};return this.inventoryEvents.set(t,s),s}async getInventoryEventsByTenant(e){return Array.from(this.inventoryEvents.values()).filter(t=>t.tenantId===e).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}async getInventoryBalance(e,t,s,n){let a=`${e}|${t}|${s}|${n}`;return this.inventoryBalances.get(a)}async upsertInventoryBalance(e){let t=`${e.tenantId}|${e.siteId}|${e.itemId}|${e.locationId}`,s=this.inventoryBalances.get(t),a={id:s?.id||(0,n.randomUUID)(),...e};return this.inventoryBalances.set(t,a),a}async getInventoryBalancesBySite(e){return Array.from(this.inventoryBalances.values()).filter(t=>t.siteId===e)}async getSessionUser(e){let t=this.users.get(e);if(!t)return null;let s=this.tenants.get(t.tenantId);return s?{id:t.id,email:t.email,firstName:t.firstName,lastName:t.lastName,role:t.role,tenantId:t.tenantId,tenantName:s.name,siteIds:t.siteIds}:null}}let l=new i}};